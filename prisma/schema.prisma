datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Gender {
  MALE
  FEMALE
}

enum AppType {
  BACHELORS
  MASTERS
}

enum AppStatus {
  APPLIED
  IN_REVIEW
  ACCEPTED
  WAITLISTED
  REJECTED
}

enum PaymentStatus {
  PAID
  UNPAID
}

enum Semester {
  FALL
  SPRING
}

enum TestType {
  IELTS
  TOPIK
  SAT
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum DocumentType {
  PASSPORT
  MOTHER_PASSPORT
  FATHER_PASSPORT
  TRANSCRIPT
}

model User {
  id       String @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fullname String @default("John Doe")
  email    String @unique
  password String

  role Role @default(USER)

  appType  AppType  @default(BACHELORS)
  appID    String   @default("B000000")
  semester Semester @default(FALL)

  profile              Profile?
  family               Family?
  applications         Application[]
  favoriteUniversities FavoriteUniversity[]
  documents            Document[]
  education            Education?
  testScores           TestScores[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([createdAt])
}

model Profile {
  id                String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName         String
  middleName        String?
  lastName          String
  birthDate         DateTime
  region            String
  passportNumber    String   @unique
  passportGivenDate DateTime
  passportEndDate   DateTime
  photo             String?
  address1          String?
  address2          String?
  phone             String
  gender            Gender

  countryId String  @db.Uuid
  country   Country @relation(fields: [countryId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([phone])
}

model Family {
  id                   String    @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fatherFirstName      String?
  fatherLastName       String?
  fatherBirthDate      DateTime?
  fatherPassportNumber String?
  fatherPhone          String?
  fatherOccupation     String?
  motherFirstName      String?
  motherLastName       String?
  motherBirthDate      DateTime?
  motherPassportNumber String?
  motherPhone          String?
  motherOccupation     String?

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
}

model Education {
  id             String    @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolName     String
  entryDate      DateTime?
  graduationDate DateTime?

  userId String @unique @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
}

model TestScores {
  id         String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type       TestType
  score      Decimal
  submitDate DateTime
  upload     String

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
}

model Country {
  id   String @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name String @unique

  profiles     Profile[]
  universities University[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([id])
}

model University {
  id               String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  photos           String[]
  name             String   @unique
  longDescription  String
  shortDescription String
  address          String
  websiteUrl       String

  countryId String  @db.Uuid
  country   Country @relation(fields: [countryId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  programs     Program[]
  applications Application[]
  favorites    FavoriteUniversity[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([name])
  @@index([countryId])
}

model Program {
  id          String @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  description String?

  universityId String     @db.Uuid
  university   University @relation(fields: [universityId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  applications Application[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([name])
  @@index([universityId])
}

model Application {
  id           String     @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String     @db.Uuid
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  universityId String     @db.Uuid
  university   University @relation(fields: [universityId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  programId    String     @db.Uuid
  program      Program    @relation(fields: [programId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  appStatus    AppStatus

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([userId])
  @@index([universityId])
  @@index([programId])
  @@index([universityId, programId])
  @@index([appStatus])
}

model Document {
  id     String       @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type   DocumentType @default(TRANSCRIPT)
  upload String       @default("test.jpg")

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  deletedAt DateTime?

  @@id([id])
  @@index([type, userId])
}

model FavoriteUniversity {
  id           String     @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String     @db.Uuid
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  universityId String     @db.Uuid
  university   University @relation(fields: [universityId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@id([id])
}
